---
import { SignIn, SignUp } from '@clerk/astro/components';
---

<main class="min-h-screen bg-gradient-to-br from-white via-blue-50 to-blue-100 flex items-center justify-center p-6">
  <div class="w-full max-w-5xl grid md:grid-cols-2 gap-8 items-start">
    <section class="bg-white/80 backdrop-blur-sm shadow-lg rounded-2xl p-8 border border-gray-100 flex flex-col justify-center">
      <div class="flex items-center gap-4 mb-6">
        <div class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-yellow-400 to-orange-400 shadow-md">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 h-8 text-white transform transition-transform duration-300 hover:rotate-12">
            <circle cx="12" cy="12" r="9" fill="currentColor" />
            <path d="M8 12h8M12 8v8" stroke="rgba(255,255,255,0.9)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </div>
        <div>
          <p class="text-sm uppercase tracking-wide text-blue-600 font-semibold mb-0">Bienvenido a</p>
          <h1 class="text-2xl md:text-3xl font-extrabold text-gray-900">CoinFinder — Tu colección segura</h1>
        </div>
      </div>

      <p class="text-gray-600 mb-6">Inicia sesión para ver tus monedas, subir nuevas y mantener tu colección organizada. Rápido, seguro y bonito.</p>

      <ul class="space-y-3 text-gray-700">
        <li class="flex items-start gap-3">
          <span class="text-green-500 mt-1">✔</span>
          <span>Acceso rápido con email y contraseña.</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="text-green-500 mt-1">✔</span>
          <span>Sesiones seguras y gestión por Clerk.</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="text-green-500 mt-1">✔</span>
          <span>Redirección directa a tu colección tras ingresar.</span>
        </li>
      </ul>

      <p class="text-xs text-gray-400 mt-6">Tus datos se manejan con encriptación y buenas prácticas de seguridad.</p>
    </section>

    <section class="bg-white shadow-2xl rounded-2xl p-4 md:p-6 border border-gray-100">
      <style>
        input:focus, textarea:focus, button:focus { outline: none; box-shadow: 0 0 0 6px rgba(59,130,246,0.12); border-radius: 0.375rem; }
        /* Target common Clerk classes if present */
        .cl-input:focus, .cl-input:focus-visible { box-shadow: 0 0 0 6px rgba(59,130,246,0.12); }
      </style>

      <div class="flex items-center justify-between mb-4">
        <div class="flex gap-2 w-full bg-gray-100 rounded-lg p-1">
          <button id="tab-signin" class="flex-1 py-2 px-3 rounded-lg font-semibold text-sm text-gray-800 transition-shadow focus:outline-none">Iniciar sesión</button>
          <button id="tab-signup" class="flex-1 py-2 px-3 rounded-lg font-semibold text-sm text-gray-600 transition-shadow focus:outline-none">Crear cuenta</button>
        </div>
      </div>

      <div id="panel-signin" class="opacity-100 transition-opacity duration-300">
        <div class="mb-4">
          <SignIn path="/auth" routing="path" signUpUrl="/auth?tab=signup" afterSignInUrl="/collection" />
        </div>
      </div>

      <div id="panel-signup" class="hidden opacity-0 transition-opacity duration-300">
        <SignUp path="/auth" routing="path" signInUrl="/auth?tab=signin" afterSignUpUrl="/collection" />
      </div>

      <div class="mt-6 text-center text-sm text-gray-500">Al crear cuenta aceptas nuestros <a class="text-blue-600 hover:underline" href="#">Términos</a> y <a class="text-blue-600 hover:underline" href="#">Política de privacidad</a>.</div>
    </section>
  </div>
</main>

<script>
  const tabSignin = document.getElementById('tab-signin');
  const tabSignup = document.getElementById('tab-signup');
  const panelSignin = document.getElementById('panel-signin');
  const panelSignup = document.getElementById('panel-signup');

  const setTab = (tab) => {
    const isSignin = tab !== 'signup';

    // Visual: active tab styling
    [tabSignin, tabSignup].forEach(b => b && b.classList.remove('bg-blue-50','ring-1','ring-blue-200','text-blue-600','font-bold'));
    if (isSignin) tabSignin?.classList.add('bg-blue-50','ring-1','ring-blue-200','text-blue-600','font-bold');
    else tabSignup?.classList.add('bg-blue-50','ring-1','ring-blue-200','text-blue-600','font-bold');

    // Panels: animate fade
    const show = isSignin ? panelSignin : panelSignup;
    const hide = isSignin ? panelSignup : panelSignin;

    if (!show || !hide) return;

    // Hide current with fade-out, then add hidden
    hide.classList.remove('opacity-100');
    hide.classList.add('opacity-0');
    setTimeout(() => { hide.classList.add('hidden'); }, 300);

    // Show target: remove hidden, start from opacity-0 then to opacity-100
    show.classList.remove('hidden');
    // force paint
    void show.offsetWidth;
    show.classList.remove('opacity-0');
    show.classList.add('opacity-100');
  };

  tabSignin?.addEventListener('click', () => setTab('signin'));
  tabSignup?.addEventListener('click', () => setTab('signup'));

  // Leer ?tab=signup para abrir registro directamente
  const params = new URLSearchParams(window.location.search);
  if (params.get('tab') === 'signup') setTab('signup');
</script>
