---
import Layout from '../layouts/Layout.astro';
import { SignIn, SignUp } from '@clerk/astro/components';

const clerkAppearance = {
  variables: {
    colorPrimary: '#1d4ed8',
    colorText: '#0f172a',
    borderRadius: '12px',
    fontFamily: "'Segoe UI', system-ui, -apple-system, sans-serif"
  },
  elements: {
    card: 'shadow-none bg-transparent p-0',
    formButtonPrimary: 'bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl shadow-sm h-11',
    formFieldInput:
      'rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-200 focus:border-blue-500 text-sm h-11',
    navbar: 'hidden',
    footer: 'hidden',
    socialButtonsBlockButton:
      'rounded-xl border border-slate-200 hover:border-blue-300 text-sm font-semibold h-11',
    formButtonReset: 'text-sm text-slate-600 hover:text-blue-600'
  }
};
---

<Layout>
  <style>
    :root { --blue: #1d4ed8; --slate-900: #0f172a; --slate-600: #475569; --border: #e2e8f0; --card: #ffffff; --radius: 18px; --shadow: 0 18px 48px -24px rgba(15,23,42,0.35); }
    .auth-shell { margin: 36px auto; padding: 36px 20px; max-width: 960px; border-radius: 20px; background: radial-gradient(140% 120% at 80% 10%, #eaf4ff 0%, #fff 40%, #fbfdff 80%); text-align: center; }
    .auth-title { font-size: clamp(28px, 3vw, 36px); font-weight: 800; color: var(--slate-900); margin-bottom: 8px; }
    .auth-desc { max-width: 620px; margin: 8px auto 16px; color: var(--slate-600); font-size: 16px; }
    .auth-card { width: min(520px,100%); margin: 0 auto; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 14px; text-align: left; display:flex; flex-direction:column; align-items:center; }
    .tab-switch { display:flex; gap:10px; padding:6px; background:#f1f5f9; border-radius:14px; border:1px solid var(--border); margin-bottom:14px; }
    .tab-btn { flex:1; padding:10px 12px; border:0; border-radius:10px; font-weight:700; font-size:14px; background:transparent; color:#1f2937; cursor:pointer; }
    .tab-btn.active { background:#fff; color:var(--blue); box-shadow:0 6px 20px -12px rgba(37,99,235,0.6); border:1px solid #cbd5e1; }
    .form-center { width:100%; display:flex; justify-content:center; }
    .form-center > * { width:100%; max-width:420px; }
    /* Remove heavy borders/shadows inside Clerk forms to achieve a minimal look */
    .form-center * {
      box-shadow: none !important;
      border: 0 !important;
      background: transparent !important;
    }
    @media (max-width:640px){ .auth-shell{padding:24px 12px;} }
  </style>

  <section class="auth-shell">
    <h1 class="auth-title">Tu colección segura</h1>
    <p class="auth-desc">Inicia sesión para ver tus monedas, subir nuevas y mantener tu colección organizada.</p>

    <section class="auth-card">
      <div class="tab-switch">
        <button id="tab-signin" class="tab-btn active">Iniciar sesión</button>
        <button id="tab-signup" class="tab-btn">Crear cuenta</button>
      </div>

      <div id="panel-signin">
        <div class="form-center">
          <SignIn
            path="/auth"
            routing="path"
            signUpUrl="/auth?tab=signup"
            fallbackRedirectUrl="/collection"
            appearance={clerkAppearance}
            localization={{ language: 'es' }}
          />
        </div>
      </div>

      <div id="panel-signup" style="display:none;">
        <div class="form-center">
          <SignUp
            path="/auth"
            routing="path"
            signInUrl="/auth?tab=signin"
            fallbackRedirectUrl="/collection"
            appearance={clerkAppearance}
            localization={{ language: 'es' }}
          />
        </div>
      </div>

      <div style="text-align:center;font-size:12px;color:#64748b;margin-top:10px;">Al crear cuenta aceptas nuestros <a href="#">Términos</a> y <a href="#">Política</a>.</div>
    </section>
  </section>
</Layout>

<script>
  const tabSignin = document.getElementById('tab-signin');
  const tabSignup = document.getElementById('tab-signup');
  const panelSignin = document.getElementById('panel-signin');
  const panelSignup = document.getElementById('panel-signup');

  const setTab = (tab) => {
    const isSignin = tab !== 'signup';
    [tabSignin, tabSignup].forEach((btn, idx) => { const active = (isSignin && idx === 0) || (!isSignin && idx === 1); btn?.classList.toggle('active', active); });
    const show = isSignin ? panelSignin : panelSignup;
    const hide = isSignin ? panelSignup : panelSignin;
    if (!show || !hide) return;
    hide.style.display = 'none'; show.style.display = 'block';
  };

  tabSignin?.addEventListener('click', () => setTab('signin'));
  tabSignup?.addEventListener('click', () => setTab('signup'));
  const params = new URLSearchParams(window.location.search);
  setTab(params.get('tab') === 'signup' ? 'signup' : 'signin');

  /* Replace common Clerk English texts with Spanish equivalents as a fallback
     (useful when the component's built-in localization isn't applied). */
  const translations = {
    'Welcome back! Please sign in to continue': '¡Bienvenido de nuevo! Por favor inicia sesión para continuar',
    'Welcome! Please fill in the details to get started.': '¡Bienvenido! Completa los datos para empezar.',
    'Create an account': 'Crear cuenta',
    'Create your account': 'Crear tu cuenta',
    'First name': 'Nombre',
    'Last name': 'Apellido',
    'Username': 'Nombre de usuario',
    'Optional': 'Opcional',
    'Email address or username': 'Correo electrónico o usuario',
    'Email address': 'Correo electrónico',
    'Enter email or username': 'Introduce correo o usuario',
    'Password': 'Contraseña',
    'Enter your password': 'Introduce tu contraseña',
    "Don't have an account?": '¿No tienes cuenta?',
    'Already have an account?': '¿Ya tienes cuenta?',
    'Sign up': 'Crear cuenta',
    'Sign in': 'Iniciar sesión',
    'Secured by': 'Protegido por',
    'Development mode': 'Modo desarrollo'
  };

  function replaceTextsInTree(root = document.body) {
    const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);
    const nodes = [];
    while (walker.nextNode()) nodes.push(walker.currentNode);
    for (const n of nodes) {
      const txt = n.nodeValue.trim();
      if (!txt) continue;
      for (const [eng, esp] of Object.entries(translations)) {
        if (txt.includes(eng)) {
          n.nodeValue = n.nodeValue.replace(eng, esp);
        }
      }
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    // Try replacing immediately and again after a short delay (Clerk may render async)
    replaceTextsInTree(document.querySelector('.form-center'));
    setTimeout(() => replaceTextsInTree(document.querySelector('.form-center')), 600);
  });
</script>
